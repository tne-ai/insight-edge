import pandas as pd
from tne.TNE import TNE

# Initialize session and get data
session = TNE(uid=UID, bucket_name=BUCKET, project=PROJECT, version=VERSION)
df = session.get_object("womens_rtw-shopping_list-442-1_1-with_periods-with_sizes_cleaned.csv")

# Group by colour_description and size_code, then sum the sales
size_sales = df.groupby(['colour_description', 'size_code'])['sales'].sum().reset_index()

# Find the most popular size for each color
most_popular_sizes = size_sales.loc[size_sales.groupby('colour_description')['sales'].idxmax()]

# Sort by sales in descending order and limit to 12 items
most_popular_sizes = most_popular_sizes.sort_values(by='sales', ascending=False).head(12)

# Select relevant columns
result = most_popular_sizes[['colour_description', 'size_code', 'sales']]