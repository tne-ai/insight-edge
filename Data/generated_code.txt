import pandas as pd
from tne.TNE import TNE

# Initialize TNE session
session = TNE(uid=UID, bucket_name=BUCKET, project=PROJECT, version=VERSION)

# Load data from CSV file
df = session.get_object("handbags-shopping_list-no_run-1_1-with_periods_cleaned.csv")

# Convert 'period' column to datetime and extract month
df['period'] = pd.to_datetime(df['period'], format='%Y%m')
df['month'] = df['period'].dt.strftime('%B')

# Filter data for Crossbody bag in July
crossbody_bags_july = df[(df['product_subgroup_desc'] == 'Crossbody bag') & 
                          (df['month'] == 'July')]

# Sort by sales in descending order and select top row
top_crossbody_bag_july = crossbody_bags_july.nlargest(1, 'sales')

# Select relevant columns for output
result = top_crossbody_bag_july[['style_colour_desc', 'sales', 'month', 'period']]

# Ensure result has at most 12 rows (already capped at 1 in this case)
result = result.head(12)