import pandas as pd
from tne.TNE import TNE

# Initialize session and get data
session = TNE(uid=UID, bucket_name=BUCKET, project=PROJECT, version=VERSION)
df = session.get_object("handbags-shopping_list-no_run-1_1-with_periods_cleaned.csv")

# Calculate total sales, number of style-colors, and number of stores for each subclass
subclass_profitability = df.groupby('product_subgroup_desc').agg(
    total_sales=('sales', 'sum'),
    number_of_style_colors=('style_colour_desc', 'nunique'),
    number_of_stores=('distinct_store_count', 'sum')
).reset_index()

# Calculate profitability
subclass_profitability['profitability'] = subclass_profitability['total_sales'] / (
    subclass_profitability['number_of_style_colors'] * subclass_profitability['number_of_stores']
)

# Identify subclasses with profitability less than or equal to 0
result = subclass_profitability[subclass_profitability['profitability'] <= 0]