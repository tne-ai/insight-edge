import pandas as pd
from tne.TNE import TNE

# Initialize session and get data
session = TNE(uid=UID, bucket_name=BUCKET, project=PROJECT, version=VERSION)
df = session.get_object("womens_rtw-shopping_list-442-1_1-with_periods-with_sizes_cleaned.csv")

# Convert period to datetime for sorting
df['period'] = pd.to_datetime(df['period'], format='%Y%m')

# Get the most recent period for each sku_id
most_recent_sales = df.loc[df.groupby('sku_id')['period'].idxmax()]

# Calculate total sales and number of styles for each subcategory
result = most_recent_sales.groupby('product_subgroup_desc').agg({
    'sales': 'sum',
    'style_color_description': 'nunique'
}).reset_index().head(12)