import pandas as pd
from tne.TNE import TNE

# Initialize the TNE session
session = TNE(uid=UID, bucket_name=BUCKET, project=PROJECT, version=VERSION)

# Load the data
df = session.get_object("handbags-shopping_list-no_run-1_1-with_periods_cleaned.csv")

# Calculate the total margin for each style_colour_desc
df['margin_v'] = (df['aur'] - df['standard_cost_price']) * df['sales']
total_margin = df.groupby('style_colour_desc')['margin_v'].sum().reset_index()

# Find the style with the highest total margin
highest_margin_style = total_margin.sort_values(by='margin_v', ascending=False).head(1)

# Store the result
result = highest_margin_style