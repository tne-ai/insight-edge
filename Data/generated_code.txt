from tne.TNE import TNE
import pandas as pd

session = TNE(uid=UID, bucket_name=BUCKET, project=PROJECT, version=VERSION)
df = session.get_object("handbags-shopping_list-no_run-1_1-with_periods_cleaned.csv")

# Calculate average margin for each subcategory
average_margin_df = df.groupby('product_subgroup_desc')['margin  v'].mean().reset_index()
average_margin_df.columns = ['product_subgroup_desc', 'average_margin']

# Sort by average margin in descending order
average_margin_df = average_margin_df.sort_values(by='average_margin', ascending=False).head(12)

result = average_margin_df