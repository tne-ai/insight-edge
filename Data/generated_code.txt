import pandas as pd
from tne.TNE import TNE

# Initialize session and get data
session = TNE(uid=UID, bucket_name=BUCKET, project=PROJECT, version=VERSION)
df = session.get_object("handbags-shopping_list-no_run-1_1-with_periods_cleaned.csv")

# Calculate Gross Margin and Gross Margin Percentage
df['Gross Margin'] = (df['aur'] - df['standard_cost_price']) * df['sales']
df['Gross Margin %'] = (df['Gross Margin'] / (df['aur'] * df['sales'])) * 100

# Group by product_subgroup_desc and calculate the average Gross Margin %
grouped = df.groupby('product_subgroup_desc', as_index=False)['Gross Margin %'].mean()

# Find the subclass with the highest Gross Margin %
result = grouped.sort_values(by='Gross Margin %', ascending=False).head(1)